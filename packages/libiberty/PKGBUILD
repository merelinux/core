#!/bin/bash
# shellcheck disable=SC2034,SC2154

pkgname=(libiberty-dev)
pkgver=2.40
pkgrel=1
pkgdesc='The libiberty library extracted from binutils'
arch=(x86_64)
url='http://www.gnu.org/software/binutils/'
license=(GPL3)
groups=()
depends=()
makedepends=(zlib-ng-dev)
options=()
changelog=ChangeLog

source=(
    "http://ftp.gnu.org/gnu/binutils/binutils-${pkgver}.tar.xz"
)

sha256sums=(
    0f8a4c272d7f17f369ded10a4aca28b8e304828e95526da482b0ccc4dfc9d8e1
)

build() {
    cd_unpacked_src
    mkdir build
    cd build || return 1
    ../libiberty/configure \
        --prefix=/usr \
        --disable-shared \
        --disable-werror \
        --disable-nls \
        --with-system-zlib
    make
}

package_libiberty-dev() {
    pkgfiles=(
        usr/include
        usr/lib/libiberty.a
    )
    cd_unpacked_src
    cd build || return 1
    install -d "${pkgdirbase}/dest/usr/lib" "${pkgdirbase}/dest/usr/include"
    install -m 0644 libiberty.a "${pkgdirbase}/dest/usr/lib/"
    install -m 0644 ../include/ansidecl.h "${pkgdirbase}/dest/usr/include/"
    install -m 0644 ../include/libiberty.h "${pkgdirbase}/dest/usr/include/"
    std_split_package
}
